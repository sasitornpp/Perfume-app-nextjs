# คู่มือการทำงานของ `app/profile/page.tsx`

## 1. บทนำ

ไฟล์ `app/profile/page.tsx` เป็น React component ที่ใช้สร้างหน้าโปรไฟล์ (profile page) ในแอปพลิเคชัน Next.js หน้านี้จะแสดงข้อมูลโปรไฟล์ของผู้ใช้, รายการน้ำหอมที่ผู้ใช้สร้าง, รายการน้ำหอมที่แนะนำ, รายการอัลบั้ม, และตะกร้าสินค้า

**หมายเหตุ:** คู่มือนี้ปรับแต่งสำหรับผู้ใช้ `Shinon2023`

## 2. โครงสร้างข้อมูลหลัก (State Structure)

Component นี้มีการจัดการ state ดังนี้:

* **Redux State:**
  * `user.profile`: ข้อมูลโปรไฟล์ของผู้ใช้ที่ login (ประเภท `Profile | null`). ในฐานะ `Shinon2023`, ข้อมูลนี้จะประกอบไปด้วยข้อมูลส่วนตัวของคุณ เช่น username, bio, avatar, gender, created\_at และรายการน้ำหอมที่แนะนำ (`suggestions_perfumes`), อัลบั้ม (`albums`), และน้ำหอมที่สร้าง (`perfumes`).
  * `user.albums`: รายการอัลบั้มของผู้ใช้ (ประเภท `Album[]`)
  * `user.perfumes`: รายการน้ำหอมที่ผู้ใช้สร้าง (ประเภท `Perfume[]`)
  * `user.basket`: รายการสินค้าในตะกร้าของผู้ใช้ (ประเภท `Basket[]`)

* **Component State:**
  * `activeTab`: tab ที่ active ใน Tabs component ("my-perfumes", "albums", "basket", "recommendations") (string). ค่านี้ถูกกำหนดโดย query parameter `q` ใน URL
  * `isProfileComplete`: สถานะที่บ่งบอกว่าข้อมูลโปรไฟล์ของผู้ใช้ครบถ้วนหรือไม่ (boolean). ข้อมูลครบถ้วนหมายถึงมีข้อมูลใน `user.profile`

## 3. ฟังก์ชันหลักในระบบ

ฟังก์ชันหลักในระบบคือ:

* **ดึงข้อมูลโปรไฟล์:** ดึงข้อมูลโปรไฟล์ของผู้ใช้, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้าจาก Redux store
* **แสดงข้อมูลโปรไฟล์:** แสดงข้อมูลโปรไฟล์ของผู้ใช้ (avatar, ชื่อ, bio, ข้อมูลอื่นๆ)
* **แสดง Tabbed Content:** แสดงเนื้อหาที่แตกต่างกันตาม tab ที่ถูกเลือก (My Perfumes, Recommendations, Albums, Basket)
* **จัดการการเปลี่ยน Tab:** อัปเดต URL เมื่อผู้ใช้เปลี่ยน tab
* **แสดง UI สำหรับสร้างโปรไฟล์:** หากโปรไฟล์ไม่สมบูรณ์, จะแสดง UI ให้สร้างโปรไฟล์

## 4. อธิบายการทำงานของแต่ละฟังก์ชัน

1. **เข้าถึงข้อมูลจาก Redux:** ใช้ `useSelector` hook เพื่อเข้าถึงข้อมูลโปรไฟล์, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้าจาก Redux store
2. **ตรวจสอบความสมบูรณ์ของโปรไฟล์:** ตรวจสอบว่าข้อมูลโปรไฟล์ของผู้ใช้ครบถ้วนหรือไม่
3. **จัดการ state:** ใช้ `useState` hook เพื่อจัดการ state ต่างๆ
4. **จัดการการเปลี่ยน Tab:**
    * `handleTabChange`: ฟังก์ชันนี้จะถูกเรียกใช้เมื่อผู้ใช้เปลี่ยน tab
    * ฟังก์ชันนี้จะอัปเดต URL โดยการเพิ่ม query parameter `q`
5. **จัดการการลบสินค้าออกจากตะกร้า:**
    * `handleRemoveBasket`: ฟังก์ชันนี้จะถูกเรียกใช้เมื่อผู้ใช้กดปุ่ม "Remove" ใน tab Basket
    * ฟังก์ชันนี้จะ dispatch action `removePerfumeFromBasket` เพื่อลบสินค้าออกจากตะกร้า
6. **แสดง UI:**
    * ถ้าข้อมูลโปรไฟล์ไม่ครบถ้วน: จะแสดง UI สำหรับสร้างโปรไฟล์
    * ถ้าข้อมูลโปรไฟล์ครบถ้วน: จะแสดง UI สำหรับหน้าโปรไฟล์ (ข้อมูลโปรไฟล์, tabs, เนื้อหาตามแต่ละ tab)

## 5. การจัดการสถานะ (State Management)

Component `ProfilePage` มีการจัดการ state ดังนี้:

* **Redux State:** ใช้ `useSelector` hook เพื่อเข้าถึงข้อมูลโปรไฟล์, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้าจาก Redux store. ในฐานะผู้ใช้ `Shinon2023`, ข้อมูลโปรไฟล์ของคุณจะถูกใช้ในการแสดงผลข้อมูลส่วนตัว, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้าของคุณ
* **Local State:** ใช้ `useState` hook เพื่อจัดการ state ที่เกี่ยวข้องกับ UI ของหน้า เช่น `activeTab` (ซึ่งถูกกำหนดจาก URL)

**การโหลดข้อมูล:** ข้อมูลโปรไฟล์, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้าถูกโหลดเมื่อแอปพลิเคชันเริ่มต้น และถูกเก็บไว้ใน Redux store Component `ProfilePage` เข้าถึงข้อมูลเหล่านี้ผ่าน `useSelector` hook

**การอัปเดตข้อมูล:** เมื่อผู้ใช้ทำการเปลี่ยนแปลงข้อมูล (เช่น ลบสินค้าออกจากตะกร้า) ข้อมูลจะถูกอัปเดตใน Redux store ผ่าน dispatch actions

**การจัดการข้อผิดพลาด:** ถ้าเกิดข้อผิดพลาดในการโหลดข้อมูล จะแสดงข้อความ error

โดยรวมแล้ว, `app/profile/page.tsx` เป็น component ที่ซับซ้อน มีการจัดการ state ทั้งใน local state และ Redux state มีการใช้ hooks ต่างๆ เพื่อเข้าถึงและอัปเดต state และมีการจัดการ logic ที่เกี่ยวข้องกับการแสดงข้อมูลโปรไฟล์, รายการน้ำหอม, รายการอัลบั้ม, และตะกร้าสินค้า
