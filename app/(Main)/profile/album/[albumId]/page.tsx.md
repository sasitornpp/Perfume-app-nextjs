# คู่มือการทำงานของ `app/profile/album/[albumId]/page.tsx`

## 1. บทนำ

ไฟล์ `app/profile/album/[albumId]/page.tsx` เป็น React component ที่ใช้แสดงหน้ารายละเอียดของอัลบั้มน้ำหอม (perfume album) แต่ละอัลบั้มในแอปพลิเคชัน Next.js โดย `[albumId]` เป็น dynamic route segment ที่ระบุ ID ของอัลบั้ม Component นี้ใช้ Redux เพื่อเข้าถึงข้อมูลผู้ใช้ และใช้ฟังก์ชันต่างๆ เพื่อจัดการการแสดงรายละเอียดอัลบั้ม, การแก้ไข, และการลบ

**หมายเหตุ:** คู่มือนี้ปรับแต่งสำหรับผู้ใช้ `Shinon2023`

## 2. โครงสร้างข้อมูลหลัก (State Structure)

Component นี้มีการจัดการ state ดังนี้:

* **Redux State:**
  * `user.profile`: ข้อมูลโปรไฟล์ของผู้ใช้ที่ login (ประเภท `Profile | null`). ในฐานะ `Shinon2023`, ข้อมูลนี้จะประกอบไปด้วยข้อมูลส่วนตัวของคุณ, รวมถึง ID ผู้ใช้ซึ่งใช้ในการตรวจสอบสิทธิ์ในการแก้ไข/ลบอัลบั้ม
* **Component State:**
  * `album`: ข้อมูลของอัลบั้มที่ถูกเลือก (ประเภท `AlbumWithPerfume | null`). ข้อมูลนี้จะถูกดึงมาจากฐานข้อมูลและใช้ในการแสดงรายละเอียดอัลบั้ม
  * `loading`: สถานะ loading ของข้อมูลอัลบั้ม (boolean). สถานะนี้จะบอกว่าระบบกำลังโหลดข้อมูลอัลบั้มอยู่หรือไม่
  * `error`: ข้อความ error (ถ้ามี) (ประเภท `string | null`). ใช้แสดงข้อผิดพลาดที่เกิดขึ้นระหว่างการดึงข้อมูล
  * `isEditModalOpen`: สถานะที่บ่งบอกว่า modal แก้ไขอัลบั้มเปิดอยู่หรือไม่ (boolean). ใช้ควบคุมการแสดงผลของ modal

## 3. ฟังก์ชันหลักในระบบ

ฟังก์ชันหลักในระบบคือ:

* **ดึงข้อมูลอัลบั้ม:** ดึงข้อมูลอัลบั้มจาก Supabase โดยใช้ `albumId` และ `userId`
* **ตรวจสอบสิทธิ์:** ตรวจสอบว่าผู้ใช้ที่ login (ในที่นี้คือ `Shinon2023`) เป็นเจ้าของอัลบั้มหรือไม่
* **แสดงรายละเอียดอัลบั้ม:** แสดงข้อมูลอัลบั้ม (ชื่อ, รายละเอียด, รูปภาพ, รายการน้ำหอม)
* **แก้ไขอัลบั้ม:** เปิด modal สำหรับแก้ไขข้อมูลอัลบั้ม
* **ลบอัลบั้ม:** ลบอัลบั้มออกจากระบบ

## 4. อธิบายการทำงานของแต่ละฟังก์ชัน

1. **รับ params:** Component รับ `params` จาก Next.js route (มี `albumId` เป็น property)
2. **ดึงข้อมูลอัลบั้ม:**
    * ใช้ `useEffect` hook เพื่อดึงข้อมูลอัลบั้มจาก Supabase โดยใช้ `albumId` และ `currentUserId`
    * ถ้าดึงข้อมูลสำเร็จ จะอัปเดต state `album` ด้วยข้อมูลที่ได้
    * ถ้าดึงข้อมูลไม่สำเร็จ จะตั้งค่า `error` และ `album` เป็น null
3. **ตรวจสอบสิทธิ์:** ตรวจสอบว่าผู้ใช้ที่ login (ในที่นี้คือ `Shinon2023`) เป็นเจ้าของอัลบั้มหรือไม่ (โดยเปรียบเทียบ `album.user_id` กับ `currentUserId`). หากคุณไม่ใช่เจ้าของ จะไม่สามารถแก้ไขหรือลบอัลบั้มได้
4. **จัดการ state:** ใช้ `useState` hook เพื่อจัดการ state ต่างๆ เช่น `album`, `loading`, `error`, `isEditModalOpen`
5. **จัดการการแก้ไขอัลบั้ม:**
    * `handleUpdateAlbum`: ฟังก์ชันนี้จะถูกเรียกใช้เมื่อผู้ใช้กดปุ่ม "Save" ใน modal แก้ไขอัลบั้ม
    * ฟังก์ชันนี้จะ dispatch action เพื่ออัปเดตข้อมูลอัลบั้มใน Redux store (ยังไม่มี implementation ใน code ที่ให้มา)
    * ฟังก์ชันนี้จะปิด modal แก้ไขอัลบั้ม
6. **จัดการการลบอัลบั้ม:**
    * `handleDeleteAlbum`: ฟังก์ชันนี้จะถูกเรียกใช้เมื่อผู้ใช้กดปุ่ม "Delete"
    * ฟังก์ชันนี้จะ dispatch action `removeAlbum` เพื่อลบอัลบั้มออกจากระบบ
    * ฟังก์ชันนี้จะ redirect ไปยังหน้า albums
7. **แสดง UI:** Component แสดง UI สำหรับรายละเอียดอัลบั้ม โดยใช้ component ต่างๆ จาก "@/components/ui/\*"` และ component ที่สร้างขึ้นเอง เช่น `AlbumEditModal`,`PerfumeCard`
    * แสดงชื่อ, รายละเอียด, รูปภาพ, และรายการน้ำหอมในอัลบั้ม
    * แสดงปุ่มสำหรับแก้ไข, ลบ, และแชร์ (ถ้าผู้ใช้เป็นเจ้าของอัลบั้ม)

## 5. การจัดการสถานะ (State Management)

Component `AlbumPage` มีการจัดการ state ดังนี้:

* **Redux State:** ใช้ `useSelector` hook เพื่อเข้าถึงข้อมูลโปรไฟล์ของผู้ใช้จาก Redux store. ในฐานะผู้ใช้ `Shinon2023`, ข้อมูลโปรไฟล์ของคุณจะถูกใช้เพื่อตรวจสอบสิทธิ์ในการแก้ไข/ลบอัลบั้ม
* **Local State:** ใช้ `useState` hook เพื่อจัดการ state ที่เกี่ยวข้องกับ UI ของหน้า เช่น `album`, `loading`, `error`, `isEditModalOpen`

**การโหลดข้อมูล:** ข้อมูลอัลบั้มถูกโหลดจาก Supabase เมื่อ component mount และเมื่อ `albumId` หรือ `currentUserId` เปลี่ยนแปลง

**การอัปเดตข้อมูล:** เมื่อผู้ใช้แก้ไขหรือลบอัลบั้ม ข้อมูลจะถูกอัปเดตใน Redux store ผ่าน dispatch actions

**การจัดการข้อผิดพลาด:** ถ้าไม่พบอัลบั้ม หรือเกิดข้อผิดพลาดในการดึงข้อมูล จะแสดงข้อความ error

โดยรวมแล้ว, `app/profile/album/[albumId]/page.tsx` เป็น component ที่ใช้แสดงหน้ารายละเอียดอัลบั้ม มีการจัดการ state ทั้งใน local state และ Redux state มีการใช้ hooks ต่างๆ เพื่อเข้าถึงและอัปเดต state และมีการจัดการ logic ที่เกี่ยวข้องกับการแสดงรายละเอียดอัลบั้ม, การแก้ไข, และการลบ โดยคำนึงถึงสิทธิ์ของผู้ใช้ `Shinon2023`.
